# 缓存套餐

## 一、Spring Cache

Spring Cache 是一个框架，实现了基于注解的缓存功能，只需要简单地加一个注解，就能实现缓存功能。

Spring Cache 提供了一层抽象，底层可以切换不同的缓存实现，例如：

- EHCache
- Caffeine
- Redis（常用）

在项目整，引入 Spring Cache 的坐标

sky-takeout-backend/sky-server/pom.xml

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-cache</artifactId>
</dependency>
```

### 1.1.Spring Cache 常用注解

在 Spring Cache 中提供了很多缓存操作的注解，常见的是以下的几个：

| **注解**         | **说明**                                                     |
| ---------------- | ------------------------------------------------------------ |
| `@EnableCaching` | 开启缓存注解功能，通常加在启动类上                           |
| `@Cacheable`     | 在方法执行前，先查询缓存中是否有数据，有，则直接返回缓存数据；没有，则调用方法并将方法返回值放到缓存中。 |
| `@CachePut`      | 将方法的返回值放到缓存中                                     |
| `@CacheEvict`    | 将一条或多条数据从缓存中删除                                 |

在 Spring Boot 项目中，使用缓存技术，只需在项目中导入相关缓存技术的依赖包，并在启动类上使用 `@EnableCaching` 开启缓存支持即可。

- 比如：使用 Redis 作为缓存技术，只需要导入Spring data Redis 的 maven 坐标即可。

## 二、代码开发

### 2.1.@EnableCaching 注解

在启动类上，加入 `@EnableCaching` 注解。

```java
@SpringBootApplication
@EnableTransactionManagement //开启注解方式的事务管理
@Slf4j
@EnableCaching
public class SkyApplication {
    public static void main(String[] args) {
        SpringApplication.run(SkyApplication.class, args);
        log.info("server started");
    }
}
```

### 2.2.@CachePut 注解

示例代码

```java
@CachePut(cacheNames = "UserCache", key = "#user.id")
public User save(@RequestBody user) {
    userMapper.insert(user);
    return user;
}
```

- cacheNames 可以随意填写，一般填写与业务相关的名称。
- SpEL：Spring Expression Language，Spring 表达式；格式有：
  - `#参数名.属性值`；
  - `#result.属性名`，表示返回值的属性名。
  - `#p0.属性名` / `#a0.属性名` / `#root.args[0].属性名`，表示第一个参数的属性名；
